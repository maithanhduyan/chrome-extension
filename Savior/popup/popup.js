!function(e){function t(t){for(var n,r,l=t[0],d=t[1],s=t[2],u=0,_=[];u<l.length;u++)r=l[u],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&_.push(i[r][0]),i[r]=0;for(n in d)Object.prototype.hasOwnProperty.call(d,n)&&(e[n]=d[n]);for(c&&c(t);_.length;)_.shift()();return a.push.apply(a,s||[]),o()}function o(){for(var e,t=0;t<a.length;t++){for(var o=a[t],n=!0,l=1;l<o.length;l++){var d=o[l];0!==i[d]&&(n=!1)}n&&(a.splice(t--,1),e=r(r.s=o[0]))}return e}var n={},i={4:0},a=[];function r(t){if(n[t])return n[t].exports;var o=n[t]={i:t,l:!1,exports:{}};return e[t].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=n,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="./";var l=window.webpackJsonp=window.webpackJsonp||[],d=l.push.bind(l);l.push=t,l=l.slice();for(var s=0;s<l.length;s++)t(l[s]);var c=d;a.push([176,0]),o()}({176:function(e,t,o){"use strict";o.r(t);o(224);var n=o(0),i=o(11),a=o(4),r=o(1),l=o(35),d=o(2),s=o(15),c=o.n(s),u=o(36),_=o(89),h=o.n(_),p=o(30);function w(){return new Promise(e=>{chrome.tabs.query({windowId:chrome.windows.WINDOW_ID_CURRENT,active:!0},t=>{var o=t&&t[0]&&t[0].id||-1;e(o)})})}function m(){return setTimeout(()=>{window&&window.close()},800)}class f{constructor(){var e=document.body;this._oneClickDownload=!1,this._dl=new l.a(e),this._oneClickHovered=!1,this._oneClickDownloadStarted=!1,this._closeTimer=null,d.a.load().then(()=>this._init(e))}_init(e){var t=this;this._widget=e,this._oneClickBlock=n.query("#one-click-block"),this._template=n.query("#list-template").textContent,this._welcome=n.query("#welcome"),this._mediaListHeight=null,w().then(e=>{chrome.runtime.sendMessage({requestType:"popup_request_media",params:{tabId:e}},o=>{if(o&&"resolve"===o.success)var n=function(e){if(!e||!e.length)return e;var t=e.slice(0);return t.forEach(e=>{delete e.id}),t}(o.data),i=new p.a(n,e,()=>{t.setDownloads(i)})})}),e.addEventListener("click",e=>{if(!t._onClick(e))return e.stopPropagation(),!0},!1),document.addEventListener("change",this._onSelectChange.bind(this),!1),this._oneClickDownload=!!d.a.get("one_click"),this._drawPopupContent()}_drawPopupContent(){n.query("#downloads").hidden=!1,this._welcome.hidden=!0}_closePreventer(){this._oneClickConfig=n.query("#one-click"),this._oneClickConfig&&(this._oneClickConfig.addEventListener("mouseenter",()=>{clearTimeout(this._closeTimer),this._oneClickHovered=!0}),this._oneClickConfig.addEventListener("mouseleave",()=>{this._oneClickDownload&&this._oneClickHovered&&this._oneClickDownloadStarted&&(this._closeTimer=m()),this._oneClickHovered=!1}))}_showWelcomeScreen(){var e=n.query("#welcome-template").textContent,t=c.a.render(e,{i18n_welcome_title:n.i18n("popup_welcome_title"),i18n_welcome_text:n.i18n("popup_welcome_text"),i18n_welcome_button:n.i18n("popup_welcome_button")});this._welcome.innerHTML=t}_showOneClickDownloadScreen(e){var t=n.query("#one-click-template").textContent,o=c.a.render(t,{media:e,i18n_starting_download:n.i18n("popup_starting_download"),i18n_download_failed:n.i18n("popup_download_failed"),i18n_one_click:n.i18n("popup_one_click"),is_single:this._oneClickDownload,dark_theme:d.a.get("dark_theme")});this._oneClickBlock.innerHTML=o,n.query("#downloads").hidden=!0,this._oneClickBlock.hidden=!1,d.a.get("dark_theme")&&this._oneClickBlock.classList.add("dark-theme"),this._closePreventer(),r.a.log("PageShown",r.a.PAGE_ONE_CLICK_DOWNLOAD)}_onClick(e){var t=e.target;"quality-level-selection"!==t.id&&n.queryAll(".j-quality-selector:not([hidden])",this._widget).forEach(e=>{n.isDescendant(e,t)||n.isDescendant(e.parentNode,t)||(e.setAttribute("hidden",!0),this._tunePopupHeight(e,!1))});switch(t.id){case"close-popup":return void window.close();case"welcome-button":return this._drawPopupContent(),r.a.log("ButtonClicked",r.a.BUTTON_TRY_IT_NOW),void setTimeout(()=>{document.body.offsetHeight},0)}switch(t.tagName){case"A":case"SPAN":var o=t;if("SPAN"===t.tagName.toUpperCase()&&(o=t.parentNode),!o.classList.contains("j-quality-download")&&o.classList.contains("select-wrapper")){var i=n.query(".j-quality-selector",o);if(i)i.classList.contains("init")||(i.classList.add("popup-mode"),i.classList.add("init"),new u.a(i,{wheelPropagation:!0})),i.hasAttribute("hidden")?(i.removeAttribute("hidden"),this._tunePopupHeight(i,!0)):(i.setAttribute("hidden","hidden"),this._tunePopupHeight(i,!1));return!0}return!o.classList.contains("j-quality-download")||void this._download(o);case"INPUT":if(!t.classList.contains("j-one-click"))return!0;var a=!!t.checked;return d.a.set("one_click",a),void r.a.log("CheckBoxClicked",r.a.CHECK_BOX_ENABLE_ONE_CLICK+a);case"BUTTON":if(t.matches(".play-now-btn")){var l=parseInt(e.target.dataset.downloadId);chrome.runtime.sendMessage({method:"play",requestType:"downloads",params:l}),r.a.log("PlayNow",r.a.PLAY_NOW_WIDGET_CLICKED),m()}break;case"DIV":t.matches(".quality-label.j-quality")&&this._onSelectChange(event)}return!0}_onSelectChange(e){var t=e.target;if(!t.matches(".j-one-click")){if("quality-level-selection"===t.id)return d.a.set("preferred_quality_level",t.value),void r.a.log("OneClickQualityChanged",a.a.getOneClickQualityIndex(t.value));var o=t.getAttribute("data-quality-value").trim(),i=o.split("/")[1];if(d.a.get("prefer_last_quality")&&1===n.queryAll(".j-media-scope",this._widget).length){var l=a.a.getQualityLevelByQualityType(i);d.a.set("preferred_quality_level",l),d.a.set("preferred_quality:"+l,o)}var s=n.findParent(t,"j-media-scope"),c=n.findParent(t,"j-quality-selector");return c.setAttribute("data-selected-value",o),this._markSelected(t,c),this._dl._applyCurrentValues(s,c),r.a.log("VideoQualityChanged",a.a.getVideoQualityIndex(i)),c.setAttribute("hidden",!0),this._tunePopupHeight(c,!1),!1}}_markSelected(e,t){n.queryAll(".quality-label.selected",t).forEach(e=>e.classList.remove("selected")),e.classList.add("selected")}_tunePopupHeight(e){if(arguments.length>1&&void 0!==arguments[1]&&arguments[1]){var t=Object(i.c)(e),o=window.innerHeight,n=window.scrollY,a=t.height+t.top;a>=o+n&&h.a.top(document.body,a-o+20,{duration:300})}}_render(){var e=d.a.get("preferred_quality_level");this._dl.render(this._template,{is_single:this._oneClickDownload,quality_levels:a.a.QUALITY_LEVELS.map(t=>({i18n_ql_title:n.i18n("ql_"+t.toLowerCase()),name:t,is_checked:t===e})),i18n_download:n.i18n("popup_download"),i18n_wait:n.i18n("popup_download_starting"),i18n_one_click:n.i18n("popup_one_click"),i18n_preferred_quality:n.i18n("popup_preferred_quality"),i18n_no_media_found:n.i18n("popup_no_media_found"),i18n_download_failed:n.i18n("popup_download_failed"),i18n_sound_only:n.i18n("popup_sound_only"),i18n_play_now:n.i18n("play_now_play_now"),has_pip:!1},e),this._downloadsNode=document.querySelector(".downloads-list")}_showDownloadError(){var e=n.query("#error-message");e.classList.add("visible"),this._errorTimeout&&clearTimeout(this._errorTimeout),this._errorTimeout=setTimeout(()=>{e.classList.remove("visible")},5e3),chrome.extension.getBackgroundPage().console.error("Download has failed")}_download(e){var t=this._dl.download(e);t&&(n.queryAll(".j-media-scope",this._widget).length,t.then(t=>{t||(e.setAttribute("disabled",!0),this._showDownloadError())}),r.a.log("Download",r.a.DOWNLOAD_BUTTON))}setDownloads(e){var t=this;t._dl.setDownloads(e);var o=e.getMediaCountByTitle();if(t._oneClickDownload&&1===o){var i=d.a.get("preferred_quality_level"),l=d.a.get("prefer_last_quality")&&d.a.get("preferred_quality:"+i),s=a.a.chooseBestDownload(e.data,i,l);t._showOneClickDownloadScreen(s),e.download(s.id).then(()=>{this._oneClickDownloadStarted=!0,this._oneClickHovered||(this._closeTimer=m()),f.changeTextOneClickStarted()}).catch(e=>{t._render(),n.query("#downloads").hidden=!1,t._oneClickBlock.hidden=!0,t._showDownloadError(e)}),r.a.log("Download",r.a.DOWNLOAD_AUTO)}else t._render(),r.a.log("PageShown",0===o?r.a.PAGE_NO_MEDIA_FOUND:r.a.PAGE_DOWNLOADS_LIST)}static changeTextOneClickStarted(){var e=document.querySelector(".one-click-starting");e&&(e.innerText=n.i18n("downloading_word"))}}window.onload=()=>{var e=chrome.extension.getBackgroundPage();window.downloads=e.downloads,window.cache=e.cache,new f,chrome.runtime.getPlatformInfo(e=>{"mac"===e.os&&setTimeout(()=>{document.body.style.width=document.body.clientWidth+1+"px"},250)})}},224:function(e,t){},89:function(e,t){var o=new Error("Element already at target scroll position"),n=new Error("Scroll cancelled"),i=Math.min,a=Date.now;function r(e){return function(t,r,s,c){"function"==typeof(s=s||{})&&(c=s,s={}),"function"!=typeof c&&(c=d);var u=a(),_=t[e],h=s.ease||l,p=isNaN(s.duration)?350:+s.duration,w=!1;return _===r?c(o,t[e]):requestAnimationFrame((function o(l){if(w)return c(n,t[e]);var d=a(),s=i(1,(d-u)/p),m=h(s);t[e]=m*(r-_)+_,s<1?requestAnimationFrame(o):requestAnimationFrame((function(){c(null,t[e])}))})),function(){w=!0}}}function l(e){return.5*(1-Math.cos(Math.PI*e))}function d(){}e.exports={left:r("scrollLeft"),top:r("scrollTop")}}});